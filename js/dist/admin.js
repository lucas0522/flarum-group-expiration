/*! For license information please see admin.js.LICENSE.txt */
(()=>{var t={24(t,e,o){var n=o(163),r=o(110),a=o(996),i=o(312),s=o(166),u=o(766),c=o(760);function l(){"use strict";var e=r(),o=e.m(l),p=(Object.getPrototypeOf?Object.getPrototypeOf(o):o.__proto__).constructor;function d(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))}var m={throw:1,return:2,break:3,continue:3};function f(t){var e,o;return function(n){e||(e={stop:function(){return o(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return o(n.a,m[t],e)},delegateYield:function(t,r,a){return e.resultName=r,o(n.d,c(t),a)},finish:function(t){return o(n.f,t)}},o=function(t,o,r){n.p=e.prev,n.n=e.next;try{return t(o,r)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=l=function(){return{wrap:function(t,o,n,r){return e.w(f(t),o,n,r&&r.reverse())},isGeneratorFunction:d,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:s,async:function(t,e,o,n,r){return(d(e)?i:a)(f(t),e,o,n,r)},keys:u,values:c}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports},110(t,e,o){var n=o(397);function r(){var e,o,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.toStringTag||"@@toStringTag";function u(t,r,a,i){var s=r&&r.prototype instanceof l?r:l,u=Object.create(s.prototype);return n(u,"_invoke",function(t,n,r){var a,i,s,u=0,l=r||[],p=!1,d={p:0,n:0,v:e,a:m,f:m.bind(e,4),d:function(t,o){return a=t,i=0,s=e,d.n=o,c}};function m(t,n){for(i=t,s=n,o=0;!p&&u&&!r&&o<l.length;o++){var r,a=l[o],m=d.p,f=a[2];t>3?(r=f===n)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=m&&((r=t<2&&m<a[1])?(i=0,d.v=n,d.n=a[1]):m<f&&(r=t<3||a[0]>n||n>f)&&(a[4]=t,a[5]=n,d.n=f,i=0))}if(r||t>1)return c;throw p=!0,n}return function(r,l,f){if(u>1)throw TypeError("Generator is already running");for(p&&1===l&&m(l,f),i=l,s=f;(o=i<2?e:s)||!p;){a||(i?i<3?(i>1&&(d.n=-1),m(i,s)):d.n=s:d.v=s);try{if(u=2,a){if(i||(r="next"),o=a[r]){if(!(o=o.call(a,s)))throw TypeError("iterator result is not an object");if(!o.done)return o;s=o.value,i<2&&(i=0)}else 1===i&&(o=a.return)&&o.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+r+"' method"),i=1);a=e}else if((o=(p=d.n<0)?s:t.call(n,d))!==c)break}catch(t){a=e,i=1,s=t}finally{u=1}}return{value:o,done:p}}}(t,a,i),!0),u}var c={};function l(){}function p(){}function d(){}o=Object.getPrototypeOf;var m=[][i]?o(o([][i]())):(n(o={},i,function(){return this}),o),f=d.prototype=l.prototype=Object.create(m);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,s,"GeneratorFunction")),t.prototype=Object.create(f),t}return p.prototype=d,n(f,"constructor",d),n(d,"constructor",p),p.displayName="GeneratorFunction",n(d,s,"GeneratorFunction"),n(f),n(f,s,"Generator"),n(f,i,function(){return this}),n(f,"toString",function(){return"[object Generator]"}),(t.exports=r=function(){return{w:u,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},163(t){t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166(t,e,o){var n=o(163),r=o(397);t.exports=function t(e,o){function a(t,r,i,s){try{var u=e[t](r),c=u.value;return c instanceof n?o.resolve(c.v).then(function(t){a("next",t,i,s)},function(t){a("throw",t,i,s)}):o.resolve(c).then(function(t){u.value=t,i(u)},function(t){return a("throw",t,i,s)})}catch(t){s(t)}}var i;this.next||(r(t.prototype),r(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),r(this,"_invoke",function(t,e,n){function r(){return new o(function(e,o){a(t,n,e,o)})}return i=i?i.then(r,r):r()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183(t,e,o){var n=o(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312(t,e,o){var n=o(110),r=o(166);t.exports=function(t,e,o,a,i){return new r(n().w(t,e,o,a),i||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397(t){function e(o,n,r,a){var i=Object.defineProperty;try{i({},"",{})}catch(o){i=0}t.exports=e=function(t,o,n,r){function a(o,n){e(t,o,function(t){return this._invoke(o,n,t)})}o?i?i(t,o,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[o]=n:(a("next",0),a("throw",1),a("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(o,n,r,a)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735(t){function e(o){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(o)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760(t,e,o){var n=o(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],o=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766(t){t.exports=function(t){var e=Object(t),o=[];for(var n in e)o.unshift(n);return function t(){for(;o.length;)if((n=o.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996(t,e,o){var n=o(312);t.exports=function(t,e,o,r,a){var i=n(t,e,o,r,a);return i.next().then(function(t){return t.done?t.value:i.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function o(n){var r=e[n];if(void 0!==r)return r.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,o),a.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["admin/app"];var e=o.n(t);function n(t,e,o,n,r,a,i){try{var s=t[a](i),u=s.value}catch(t){return void o(t)}s.done?e(u):Promise.resolve(u).then(n,r)}function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}var i=o(183),s=o.n(i);const u=flarum.core.compat["admin/components/ExtensionPage"];var c=o.n(u);const l=flarum.core.compat["common/components/Button"];var p=o.n(l);const d=flarum.core.compat["common/components/LoadingIndicator"];var f=o.n(d);const h=flarum.core.compat["common/utils/ItemList"];var g=o.n(h);const y=flarum.core.compat["common/utils/classList"];var v=o.n(y);const x=flarum.core.compat["common/helpers/icon"];var b=o.n(x);const P=flarum.core.compat["common/components/GroupBadge"];var _=o.n(P);const w=flarum.core.compat["common/components/Modal"];var N=o.n(w);const C=flarum.core.compat["common/utils/Stream"];var k=o.n(C),T=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var n=o.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.groupId=k()(""),this.days=k()(""),this.amount=k()("1"),this.loading=!1,this.generatedCodes=null},n.className=function(){return"Modal--small"},n.title=function(){return this.generatedCodes?"ç”ŸæˆæˆåŠŸ":"ç”Ÿæˆå…‘æ¢ç "},n.content=function(){var t=this;if(this.generatedCodes){var o=this.generatedCodes.join("\n");return m(".Modal-body",[m(".Form-group",[m("p",{style:"color: #109e59; font-weight: bold; text-align: center; margin-bottom: 15px;"},"ğŸ‰ æˆåŠŸç”Ÿæˆ "+this.generatedCodes.length+" ä¸ªå…‘æ¢ç ï¼"),m("textarea.FormControl",{style:"height: 200px; font-family: monospace; font-size: 13px; line-height: 1.5;",readonly:!0,onclick:function(t){return t.target.select()}},o)]),m(".Form-group",{style:"display: flex; gap: 10px;"},[m(p(),{className:"Button Button--primary Button--block",onclick:function(){navigator.clipboard.writeText(o),e().alerts.show({type:"success"},"å·²å¤åˆ¶æ‰€æœ‰å…‘æ¢ç ")}},"ä¸€é”®å¤åˆ¶"),m(p(),{className:"Button Button--block",onclick:function(){return t.downloadTxt(o)}},"ä¸‹è½½ TXT")]),m(".Form-group",[m(p(),{className:"Button Button--link Button--block",onclick:function(){return t.closeAndRefresh()}},"å®Œæˆå¹¶å…³é—­")])])}return m(".Modal-body",[m(".Form",[m(".Form-group",[m("label","ç¾¤ç»„ ID"),m("input.FormControl",{bidi:this.groupId,placeholder:"ä¾‹å¦‚: 7"})]),m(".Form-group",[m("label","æœ‰æ•ˆå¤©æ•°"),m("input.FormControl",{bidi:this.days,placeholder:"ä¾‹å¦‚: 30"})]),m(".Form-group",[m("label","ç”Ÿæˆæ•°é‡"),m("input.FormControl",{bidi:this.amount,type:"number",placeholder:"1"})]),m(".Form-group",[m(p(),{className:"Button Button--primary Button--block",loading:this.loading,onclick:this.onsubmit.bind(this)},"æäº¤ç”Ÿæˆ")])])])},n.downloadTxt=function(t){var e=new Blob([t],{type:"text/plain"}),o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download="redemption_codes_"+(new Date).toISOString().slice(0,10)+".txt",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)},n.closeAndRefresh=function(){this.hide(),this.attrs.onSuccess&&this.attrs.onSuccess()},n.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/redemption/create",body:{group_id:this.groupId(),days:this.days(),amount:this.amount()}}).then(function(t){o.loading=!1,t.codes?(o.generatedCodes=t.codes,m.redraw()):(o.hide(),e().alerts.show({type:"success"},"ç”ŸæˆæˆåŠŸ"),o.attrs.onSuccess&&o.attrs.onSuccess())}).catch(function(){o.loading=!1,m.redraw()})},o}(N()),B=function(t){function o(){return t.apply(this,arguments)||this}a(o,t);var r=o.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.codes=[],this.stats={total:0},this.pageNumber=0,this.limit=20,this.query="",this.loadingPageNumber=0,this.refresh()},r.refresh=function(){this.loading=!0,this.loadPage(this.pageNumber)},r.getTotalPageCount=function(){return 0===this.stats.total?1:Math.ceil(this.stats.total/this.limit)},r.content=function(){var t=this;if(this.loading&&!this.codes.length)return m(".container",m(f()));var e=this.columns().toArray();return m(".RedemptionCodePage",[m(".container",[m(".RedemptionCodePage-header",this.headerItems().toArray()),m("section",{className:v()(["RedemptionCodePage-grid",this.loading?"RedemptionCodePage-grid--loadingPage":"RedemptionCodePage-grid--loaded"]),role:"table","aria-rowcount":this.codes.length+1,"aria-colcount":e.length,style:{"--columns":e.length}},[e.map(function(t,e){return m(".RedemptionCodePage-grid-header",{role:"columnheader","aria-colindex":e+1},t.name)}),this.codes.length>0?this.codes.map(function(t,o){return e.map(function(e,n){return m(".RedemptionCodePage-grid-rowItem",{className:o%2!=0?"RedemptionCodePage-grid-rowItem--shaded":"","data-column-name":e.itemName,role:"cell","aria-colindex":n+1},e.content(t))})}):m(".RedemptionCodePage-grid-rowItem",{style:"grid-column: 1 / -1; justify-content: center; padding: 40px; color: #999;"},"æš‚æ— æ•°æ®")]),m("nav.RedemptionCodePage-gridPagination",[m(p(),{icon:"fas fa-step-backward",className:"Button Button--icon",disabled:this.loading||0===this.pageNumber,onclick:function(){return t.goToPage(1)},title:"ç¬¬ä¸€é¡µ"}),m(p(),{icon:"fas fa-chevron-left",className:"Button Button--icon",disabled:this.loading||0===this.pageNumber,onclick:function(){return t.goToPage(t.pageNumber)},title:"ä¸Šä¸€é¡µ"}),m("span.RedemptionCodePage-pageNumber",["ç¬¬ ",m("input.FormControl.RedemptionCodePage-pageNumberInput",{type:"text",value:this.loadingPageNumber+1,disabled:this.loading,onchange:function(e){var o=parseInt(e.target.value);isNaN(o)&&(o=1),o=Math.max(1,Math.min(o,t.getTotalPageCount())),t.goToPage(o)}})," é¡µ / å…± "+this.getTotalPageCount()+" é¡µ"]),m(p(),{icon:"fas fa-chevron-right",className:"Button Button--icon",disabled:this.loading||this.pageNumber>=this.getTotalPageCount()-1,onclick:function(){return t.goToPage(t.pageNumber+2)},title:"ä¸‹ä¸€é¡µ"}),m(p(),{icon:"fas fa-step-forward",className:"Button Button--icon",disabled:this.loading||this.pageNumber>=this.getTotalPageCount()-1,onclick:function(){return t.goToPage(t.getTotalPageCount())},title:"æœ€åä¸€é¡µ"})])])])},r.columns=function(){var t=this,o=new(g());return o.add("id",{itemName:"id",name:"ID",content:function(t){return t.id}},100),o.add("key",{itemName:"key",name:"å…‘æ¢ç ",content:function(e){return m("span",{style:"font-weight: bold; color: var(--primary-color); cursor: pointer; font-family: monospace; font-size: 1.1em;",onclick:function(){return t.copyCode(e.code)},title:"ç‚¹å‡»å¤åˆ¶"},e.code)}},90),o.add("group",{itemName:"group",name:"æƒç›Šå†…å®¹",content:function(t){var o=e().store.getById("groups",t.group_id);return o?m("div",{style:"display: flex; align-items: center;"},[m(_(),{group:o,label:null,style:"margin-right: 6px;"}),m("span",{style:"font-weight: bold; margin-right: 8px;"},o.nameSingular()),m("span.Badge",{style:"background: #e8ecf3; color: #666; font-size: 11px; padding: 2px 6px; border-radius: 4px;"},t.days+"å¤©")]):m("span",{style:"opacity: 0.6"},"ID: "+t.group_id+" / "+t.days+"å¤©")}},80),o.add("status",{itemName:"status",name:"çŠ¶æ€",content:function(t){return t.is_used?m("span",{style:"color: #d83e3e; font-weight: bold; opacity: 0.6;"},[b()("fas fa-times")," å·²ä½¿ç”¨"]):m("span",{style:"color: #109e59; font-weight: bold;"},[b()("fas fa-check")," æœ‰æ•ˆ"])}},70),o.add("created",{itemName:"created",name:"åˆ›å»ºæ—¶é—´",content:function(t){return t.created_at?t.created_at.substring(0,16).replace("T"," "):"-"}},60),o.add("actions",{itemName:"actions",name:"æ“ä½œ",content:function(e){return m(p(),{className:"Button Button--icon Button--link",icon:"fas fa-copy",onclick:function(){return t.copyCode(e.code)},title:"å¤åˆ¶å¡å¯†"})}},50),o},r.headerItems=function(){var t=this,o=new(g());return o.add("search",m(".Search-input",m("input.FormControl",{type:"search",placeholder:"æœç´¢å…‘æ¢ç ...",value:this.query,oninput:function(e){t.query=e.target.value,t.pageNumber=0,clearTimeout(t.searchTimeout),t.searchTimeout=setTimeout(function(){return t.loadPage(0)},300)}})),100),o.add("total",m("p.RedemptionCodePage-total","æ€»æ•°: "+this.stats.total),90),o.add("actions",m(".RedemptionCodePage-actions",[m(p(),{className:"Button RedemptionCodePage-createBtn",icon:"fas fa-door-open",onclick:function(){return e().modal.show(T,{onSuccess:function(){return t.loadPage(0)}})}},"ç”Ÿæˆå…‘æ¢ç ")]),80),o},r.loadPage=function(){var t,o=(t=s().mark(function t(o){var n,r=this;return s().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o<0&&(o=0),this.loadingPageNumber=o,this.pageNumber=o,this.loading=!0,m.redraw(),n={limit:this.limit,offset:o*this.limit,q:this.query},t.abrupt("return",e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/redemption/codes",params:n}).then(function(t){r.codes=t.data,r.stats=t.stats||{total:t.meta.total},m.redraw()}).catch(function(t){console.error(t)}).finally(function(){r.loading=!1,m.redraw()}));case 1:case"end":return t.stop()}},t,this)}),function(){var e=this,o=arguments;return new Promise(function(r,a){var i=t.apply(e,o);function s(t){n(i,r,a,s,u,"next",t)}function u(t){n(i,r,a,s,u,"throw",t)}s(void 0)})});return function(t){return o.apply(this,arguments)}}(),r.goToPage=function(t){this.loading||this.loadPage(t-1)},r.copyCode=function(t){navigator.clipboard&&(navigator.clipboard.writeText(t),e().alerts.show({type:"success"},"å·²å¤åˆ¶"))},o}(c());e().initializers.add("hertz-dev-group-expiration",function(){e().extensionData.for("hertz-dev-group-expiration").registerPermission({icon:"fas fa-clock",label:"å…è®¸ç¼–è¾‘ä¼šå‘˜è¿‡æœŸæ—¶é—´",permission:"hertz-dev.group-expiration.edit"},"moderate").registerPage(B)})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map