(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";const e=flarum.core.compat["forum/app"];var o=t.n(e);const r=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/utils/UserControls"];var n=t.n(a);const i=flarum.core.compat["common/components/Button"];var s=t.n(i);const u=flarum.core.compat["forum/components/UserCard"];var l=t.n(u);const c=flarum.core.compat["common/helpers/icon"];var p=t.n(c);function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}const h=flarum.core.compat["common/components/Modal"];var f=t.n(h);const v=flarum.core.compat["common/utils/Stream"];var g=t.n(v),y=function(t){function e(){return t.apply(this,arguments)||this}var r,a;a=t,(r=e).prototype=Object.create(a.prototype),r.prototype.constructor=r,d(r,a);var n=e.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.user=this.attrs.user,this.existingExpirations=this.user.attribute("groupExpirations")||{},this.groupId=g()(""),this.mode=g()("set"),this.date=g()(""),this.days=g()(""),this.currentExpiration=g()(null)},n.className=function(){return"ExpirationModal Modal--small"},n.title=function(){return"è®¾ç½®ç¾¤ç»„è¿‡æœŸæ—¶é—´"},n.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,"é€‰æ‹©ç¾¤ç»„"),m("select",{className:"FormControl",value:this.groupId(),onchange:function(e){return t.onGroupChange(e.target.value)}},m("option",{value:"",disabled:!0},"è¯·é€‰æ‹©..."),o().store.all("groups").filter(function(t){return!["2","3"].includes(t.id())}).map(function(e){return m("option",{key:e.id(),value:e.id()},e.namePlural(),t.existingExpirations[e.id()]?" (ç”Ÿæ•ˆä¸­)":"")}))),this.groupId()&&m("div",{className:"Form-group"},m("label",null,"å½“å‰çŠ¶æ€"),m("div",{className:"HelpText",style:{marginTop:0}},this.currentExpiration()?"ğŸ“… å½“å‰è¿‡æœŸæ—¶é—´: "+this.currentExpiration():"âšª è¯¥ç¾¤ç»„ç›®å‰æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ (æ°¸ä¹…æˆ–æœªåŠ å…¥)")),this.currentExpiration()&&m("div",{className:"Form-group"},m("label",null,"æ“ä½œæ¨¡å¼"),m("div",{className:"Select"},m("select",{className:"FormControl",value:this.mode(),onchange:function(e){t.mode(e.target.value),t.recalculate()}},m("option",{value:"set"},"ğŸ”„ é‡æ–°è®¾ç½® (è¦†ç›–æ—§æ—¥æœŸ)"),m("option",{value:"add"},"â• / â– å¢åŠ æˆ–å‡å°‘å¤©æ•°")))),m("div",{className:"Form-group"},m("label",null,"add"===this.mode()&&this.currentExpiration()?"å¢åŠ å¤©æ•° (è¾“å…¥è´Ÿæ•°ä¸ºå‡å°‘)":"è¿‡æœŸæ—¶é•¿ (å¤©æ•°)"),m("input",{type:"number",className:"FormControl",placeholder:"add"===this.mode()?"ä¾‹å¦‚: 30 (ç»­è´¹30å¤©) æˆ– -5 (æ‰£é™¤5å¤©)":"ä¾‹å¦‚: 30 (ä»ä»Šå¤©èµ·ç®—)",value:this.days(),oninput:function(e){t.days(e.target.value),t.recalculate()}})),m("div",{className:"Form-group"},m("label",null,"ç»“æœé¢„è§ˆ (æäº¤åçš„æ—¥æœŸ)"),m("input",{type:"date",className:"FormControl",disabled:!0,value:this.date()}),m("div",{className:"HelpText"},this.date()?"æäº¤åï¼Œç”¨æˆ·å°†åœ¨ "+this.date()+" è¿‡æœŸ":"è¯·è¾“å…¥å¤©æ•°...")),m("div",{className:"Form-group"},s().component({type:"submit",className:"Button Button--primary",disabled:!this.groupId()||!this.date()},"ä¿å­˜è®¾ç½®")))},n.onGroupChange=function(t){this.groupId(t);var e=this.existingExpirations[t]||null;this.currentExpiration(e),e||this.mode("set"),this.days(""),this.date("")},n.recalculate=function(){var t=parseInt(this.days());if(isNaN(t))this.date("");else{var e;(e="add"===this.mode()&&this.currentExpiration()?new Date(this.currentExpiration()):new Date).setDate(e.getDate()+t);var o=e.toISOString().split("T")[0];this.date(o)}},n.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/group-expiration",body:{userId:this.user.id(),groupId:this.groupId(),expirationDate:this.date()}}).then(function(){e.hide(),o().alerts.show({type:"success"},"è®¾ç½®æˆåŠŸï¼"),window.location.reload()}).catch(function(){e.loading=!1,m.redraw()})},e}(f());o().initializers.add("hertz-dev-group-expiration",function(){(0,r.extend)(n(),"userControls",function(t,e){e&&"function"==typeof e.attribute&&o().session.user&&e.attribute("canSetGroupExpiration")&&t.add("expiration",s().component({icon:"fas fa-clock",onclick:function(){return o().modal.show(y,{user:e})}},"è®¾ç½®ç¾¤ç»„è¿‡æœŸæ—¶é—´"))}),(0,r.extend)(l().prototype,"infoItems",function(t){var e=this.attrs.user;if(e&&"function"==typeof e.attribute){var r=e.attribute("groupExpirations");r&&0!==Object.keys(r).length&&Object.keys(r).forEach(function(e){var a=o().store.getById("groups",e);a&&t.add("expiration-"+e,m("span.UserCard-expiration",{style:{margin:"5px 0",display:"block"}},[p()("fas fa-hourglass-half")," ",a.nameSingular(),": ",m("strong",r[e])," åˆ°æœŸ"]))})}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map