(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var r in e)t.o(e,r)&&!t.o(o,r)&&Object.defineProperty(o,r,{enumerable:!0,get:e[r]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["forum/app"];var e=t.n(o);const r=flarum.core.compat["common/extend"],a=flarum.core.compat["forum/utils/UserControls"];var n=t.n(a);const i=flarum.core.compat["common/components/Button"];var s=t.n(i);function u(t,o){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},u(t,o)}const l=flarum.core.compat["common/components/Modal"];var c=t.n(l);const p=flarum.core.compat["common/utils/Stream"];var d=t.n(p),f=function(t){function o(){return t.apply(this,arguments)||this}var r,a;a=t,(r=o).prototype=Object.create(a.prototype),r.prototype.constructor=r,u(r,a);var n=o.prototype;return n.oninit=function(o){t.prototype.oninit.call(this,o),this.user=this.attrs.user,this.groupId=d()(""),this.days=d()(""),this.date=d()("")},n.className=function(){return"ExpirationModal Modal--small"},n.title=function(){return"设置群组过期时间"},n.content=function(){var t=this;return m("div",{className:"Modal-body"},m("div",{className:"Form-group"},m("label",null,"选择群组"),m("select",{className:"FormControl",value:this.groupId(),onchange:function(o){return t.groupId(o.target.value)}},m("option",{value:"",disabled:!0},"请选择..."),e().store.all("groups").filter(function(t){return!["2","3"].includes(t.id())}).map(function(t){return m("option",{key:t.id(),value:t.id()},t.namePlural())}))),m("div",{className:"Form-group"},m("label",null,"过期时长 (天数)"),m("input",{type:"number",className:"FormControl",placeholder:"例如: 30",value:this.days(),oninput:function(o){t.days(o.target.value),t.updateDate()}})),m("div",{className:"Form-group"},m("label",null,"结果预览"),m("input",{type:"text",className:"FormControl",disabled:!0,value:this.date()?"将于 "+this.date()+" 过期":""})),m("div",{className:"Form-group"},m(s(),{type:"submit",className:"Button Button--primary",disabled:!this.groupId()||!this.days()},"保存设置")))},n.updateDate=function(){var t=parseInt(this.days());if(isNaN(t))this.date("");else{var o=new Date;o.setDate(o.getDate()+t),this.date(o.toISOString().split("T")[0])}},n.onsubmit=function(t){var o=this;t.preventDefault(),this.loading=!0,e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/group-expiration",body:{userId:this.user.id(),groupId:this.groupId(),expirationDate:this.date()}}).then(function(){o.hide(),e().alerts.show({type:"success"},"设置成功！")}).catch(function(){o.loading=!1,m.redraw()})},o}(c());e().initializers.add("hertz-dev-group-expiration",function(){(0,r.extend)(n(),"userControls",function(t,o){o&&e().session.user&&(null==o.attribute?void 0:o.attribute("canSetGroupExpiration"))&&t.add("expiration",s().component({icon:"fas fa-clock",onclick:function(){return e().modal.show(f,{user:o})}},"设置群组过期时间"))})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map